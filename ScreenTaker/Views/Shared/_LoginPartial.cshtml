@using Microsoft.AspNet.Identity
@using System.Globalization
@using System.Threading;
@section Scripts
{
    <script>
         function setLocal(loc) {
             document.getElementById('localization').innerHTML = loc + '<span class="caret"></span>';
         }
    </script>
}

@if (Request.IsAuthenticated)
{
    using (Html.BeginForm("LogOff", "Account", FormMethod.Post, new { id = "logoutForm", @class = "navbar-right" }))
    {
        @Html.AntiForgeryToken()

        <ul class="nav navbar-nav navbar-right">
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">ENG<span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a href="@Url.Action("ChangeLocalization", "Edit", new { request = Request.Url.PathAndQuery, lang = "uk" })">UKR</a></li>
                    <li><a href="@Url.Action("ChangeLocalization", "Edit", new { request = Request.Url.PathAndQuery, lang = "ru" })">RUS</a></li>
                    <li><a href="@Url.Action("ChangeLocalization", "Edit", new { request = Request.Url.PathAndQuery, lang = "en" })">ENG</a></li>
                </ul>
            </li>
            
            <li>
                @Html.ActionLink(User.Identity.GetUserName(), "UserProfile", "Account", routeValues: null, htmlAttributes: new { title = "Manage groups" })
            </li>
            @{
                string path = "";
                if (User == null)
                {
                    path = Server.MapPath("~/Resources/") + "user.png";
                }
                else
                {
                    var email = User.Identity.GetUserName();
                    var people = ViewBag.PeopleForMaster;
                    string avatarFile = null;
                    for (int i = 0; i < people.Count; i++)
                    {
                        if (people[i].Email == email)
                        {
                            avatarFile = people[i].AvatarFile;
                        }
                    }
                    if (avatarFile != null && System.IO.File.Exists(Server.MapPath("~/avatars/") + avatarFile + "_25.png"))
                    {
                        path = "~/avatars/" + avatarFile + "_25.png";
                    }
                    else
                    {
                        path = "~/Resources/user.png";
                    }
                }               
            }            
            <li style="width:50px;z-index:5000;">
                <a href="/Account/UserProfile" style="margin: 0px; padding-bottom: 0px; padding-top: 0px;">
                    <div style="z-index:5000;height:36px;width:36px;background: transparent url(@Url.Content(path)) no-repeat center center; margin-top: 0px; width: 50px; height: 50px; margin-left: -20px;" class="img-circle">
                    </div>
                </a>
            </li>
            <li><a href="javascript:document.getElementById('logoutForm').submit()">@Resources.Resource.LOGOUT</a></li>
        </ul>
    }
}
else
{
    <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" id="localization">ENG<span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href="@Url.Action("ChangeLocalization","Edit",new { request=Request.Url.PathAndQuery, lang ="uk"})">UKR</a></li>
                <li><a href="@Url.Action("ChangeLocalization","Edit",new { request=Request.Url.PathAndQuery, lang ="ru"})">RUS</a></li>
                <li><a href="@Url.Action("ChangeLocalization","Edit",new { request=Request.Url.PathAndQuery, lang ="en"})">ENG</a></li>
            </ul>
        </li>
        <li>@Html.ActionLink(@Resources.Resource.LOGIN_EMAIL, "Login", "Account")</li>
        <li>@Html.ActionLink(@Resources.Resource.SIGNIN_LOGOUT, "Register", "Account")</li>
    </ul>
}